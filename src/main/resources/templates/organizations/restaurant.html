<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<!--<head>-->
<head th:replace="partials/head :: head">
    <meta charset="UTF-8">
    <title>Organization Index</title>
    <style>
        .mapMarker {
            background-image: url('https://i.ibb.co/bJz3x34/H3-Map-Logo.png');
            background-size: contain;
            background-repeat: no-repeat;
            width: 65px;
            height: 75px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<nav th:replace="partials/topnav :: navbar">
</nav>

<div class = "container">
<!--        <h1> These are the Restaurant listings</h1>-->
            <!--                start-->
            <section class="container-fluid" style="margin-top: 40px">
                    <div class="container">
                        <div class="row">
                            <div class="col-10">
                                <input class="form-control" id="input" type="search" placeholder="Enter by City" aria-label="Search">
                            </div>
                            <div class="col-2">
                                <button id="btn" class="form-control btn" type="submit">Search</button>
                            </div>
                        </div>
                    </div>
<!--                <div style="margin-top: 10px">-->
<!--                    <div class='mx-1 mt-3' id='map' style='height: 400px; width: auto'></div>-->
<!--&lt;!&ndash;                    <pre id="coordinates" class="coordinates">&ndash;&gt;-->
<!--&lt;!&ndash;            </pre>&ndash;&gt;-->
<!--                </div>-->
                <div class="mapbox">
                    <div class="container-fluid" id='map' style='height: 400px; width: auto'>
                        <div class="zoom-container text-center justify-content-center align-items-center" id="orgMark">
                              <pre id="coordinates" class="coordinates">
                                        </pre>




                        </div>
                    </div>
<!--&lt;!&ndash;                    <link rel='stylesheet'&ndash;&gt;-->
<!--&lt;!&ndash;                          href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css'&ndash;&gt;-->
<!--&lt;!&ndash;                          type='text/css'/>&ndash;&gt;-->
<!--                    &lt;!&ndash;            <pre id="coordinates" class="coordinates"></pre>&ndash;&gt;-->
<!--                    &lt;!&ndash;                        <input class="search" id="userInput" type="text">&ndash;&gt;-->
<!--                    &lt;!&ndash;                        <button id="button" type="button">Search</button>&ndash;&gt;-->


                </div>
<!--                <label class="zoom-label text-dark label">ZOOM</label>-->
                <div class="container">
                <div class="row">
                <button type="button" class="btn btn-light col" id="zoom5" value="zoom x 5" >Zoom 5</button>
                <button type="button" class="btn btn-light col"  id="zoom10" value="zoom x 10" >Zoom 10</button>
                <button type="button" class="btn btn-light col"  id="zoom15" value="zoom x 15" >Zoom 15</button>
                </div>
                </div>
<!--                <div id="mapboxData" th:each="organization : ${organizations}" class="flip-card card-item card-deck mt-2 my-2 m-lg-2">-->
<!--                    <div class="flip-card-inner" th:each="organization : ${organizations}">-->
<!--                        &lt;!&ndash;                <h5 th:text="${}" class="flip-card-front h3"></h5>&ndash;&gt;-->
<!--                        <p class="flip-card-front flex-column">-->
<!--                            <span class="h3" th:text="${organization.getOrgName()}"></span>-->
<!--                            <br>-->
<!--                            <span class="h5"-->
<!--                                  th:text="${organization.getOrgStAddress  + ', ' + organization.getOrgCity + ', ' + organization.getOrgState + ', ' + organization.getOrgZip }"></span>-->
<!--                        </p>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div style="margin-top: -10px"><em>Drag pin to find temperatures in other cities*</em>-->
<!--                </div>-->
                <!--                    <div class="five"  style="padding: 20px; display: flex; justify-content: center;">-->
                <!--                        <p>-->
                <!--                        <h3>Five day forecast: </h3>-->
                <!--                        <h3 id="locationPrinted" style="padding-left: 5px"></h3>-->
                <!--                    </div>-->
                <!--                    <div>-->
                <!--                        <div class="weatherBox row" id="insertWeatherBoxes"></div>-->
                <!--                    </div>-->
            </section>


    <div class="main">

                <ul class="listing-cards">
                    <li class="cards_item">


                        <div class="card">
                            <div th:each="organization : ${organizations}">
                                <div th:if="${organization.isDonor()}">
                            <div class="card_image"><img th:src="@{/imgs/burger.jpg}" /></div>
                            <div class="card_content">
                                <h2 class="card_title"><span th:text="${organization.getOrgName()}"></span></h2>
                                <p class="card_text"><span th:text="${organization.getOrgDescription()}"></span></p>
                                <p class="card_text"><span th:text="${organization.getOrgStAddress()}"></span></p>
                                <p class="card_text"><span th:text="${organization.getOrgCity()}"></span></p>
                                <p class="card_text"><span th:text="${organization.getOrgState()}"></span></p>
                                <p class="card_text"><span th:text="${organization.getOrgZip()}"></span></p>
                                <button class="btn card_btn">full description here</button>
                            </div>
                        </div>
                            </div>
                        </div>
                    </li>
                </ul>

    </div>

</div>

<footer th:replace="partials/footer.html :: footer"></footer>
<script th:replace="partials/script.html :: script"></script>


<script th:inline="javascript">
    /*<![CDATA[*/
    // console.log("Sanity confirmed");
    mapboxgl.accessToken = MAPBOX_KEY;
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [-98.4916, 29.4252],
        zoom: 7
    });
    var test = /*[[${organizations}]]*/ 'Test Default';
    // console.log(test);
    var orgName = test.map(({ orgName }) => orgName)

    var address = test.map(({ orgStAddress }) => orgStAddress)
    var city = test.map(({ orgCity }) => orgCity)
    var state = test.map(({ orgState }) => orgState)
    var zip = test.map(({ orgZip }) => orgZip)

    var entireAddress = address + ", " + city + ", " + state + ", " + zip;
    console.log(entireAddress);

    // console.log(address);
    // console.log(city);
    // console.log(state);
    // console.log(zip);
    //
    // // var donorAddress = [];
    function geocode(search, token) {
    var baseUrl = 'https://api.mapbox.com';
    var endPoint = '/geocoding/v5/mapbox.places/';
    return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
        .then(function(res) {
            return res.json();
            // to get all the data from the request, comment out the following three lines...
        }).then(function(data) {
            return data.features[0].center;
        });
    }

    //Reference for marker function : from curriculum under mapbox module
    // function placeMarkerAndPopup(info, token, map) {
    //     geocode(info.address, token).then(function(coordinates) {
    //         var popup = new mapboxgl.Popup()
    //             .setHTML(info.popupHTML);
    //         var marker = new mapboxgl.Marker()
    //             .setLngLat(coordinates)
    //             .addTo(map)
    //             .setPopup(popup);
    //         popup.addTo(map);
    //     });
    // }

    function placeMarker(address, token, map){
        geocode(address, token).then(function(coordinates) {
                    var marker = new mapboxgl.Marker()
                        .setLngLat(coordinates)
                        .addTo(map)

                });

    }

    function placeMarkerAndPopup(address, token, map){
        geocode(address, token).then(function(coordinates) {
            var popup = new mapboxgl.Popup()
                .setHTML("<h1>" + address + "</h1>");
            var marker = new mapboxgl.Marker()
                .setLngLat(coordinates)
                .addTo(map)
                .setPopup(popup);
            popup.addTo(map);

                });

    }


    for (var i = 0; i < test.length; i++) {


        var entireAddress = test[i].orgStAddress + ", " + test[i].orgCity + ", " + test[i].orgState + ", " + test[i].orgZip;
        console.log(entireAddress);

        // placeMarker(entireAddress, MAPBOX_KEY, map)
        placeMarkerAndPopup(entireAddress, MAPBOX_KEY, map)

        }


    // Map Nav Controls
    map.addControl(new mapboxgl.NavigationControl());
    // const nav = new mapboxgl.NavigationControl({
    //     showZoom: true
    // });


    //Starting Draggable Marker (default point)
    var marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([-98.4916, 29.4252])
        .addTo(map);
    //
    // let myLocation = geocode(search, MAPBOX_KEY);
    // myLocation.then(function(data) {
    //     $('#locationPrinted').text(data);});
    // console.log(data);


    // }



    $(document).ready(function () {
        $(".removeMarkers").click(function () {
            $('marker').toggle()
        });
    });
    // $(".btn").click(function (e) {
    //     e.preventDefault()
    //     let searchInput = $("#input").val();
    //     geocode(searchInput, MAPBOX_KEY).then(function (data) {
    //         longitude = data[0];
    //         latitude = data[1];
    //         // getData();
    //     })
    // })

    $(document).ready(function () {
        $('#zoom5').click(function (e) {
            map.flyTo({zoom: 5});
        });
        $(document).ready(function () {
            $('#zoom10').click(function (e) {
                map.flyTo({zoom: 10});
            });
            $(document).ready(function () {
                $('#zoom15').click(function (e) {
                    map.flyTo({zoom: 15});
                })
            });
        });
    });

// // pinkertons bbq
//     const popup = new mapboxgl.Popup({ closeOnClick: false })
//         .setLngLat([-98.494510, 29.426490])
//         .setHTML('<h5>Pinkertons BBQ</h5>' + '<p>107 W Houston Street</p>')
//         .addTo(map);
//     // yardhouse
//    new mapboxgl.Popup({ closeOnClick: false })
//
//             .setLngLat([-98.484879, 29.423950])
//         .setHTML('<h5>Yardhouse</h5>' + '<p>107 W Houston Street</p>')
//         .addTo(map);




    // const description = geojson.features[0].properties.description;
    // Add markers to the map.

//     const geocode = (inputLocation, inputName) => {
//         fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${address[0]+city[0]+state[0]+zip[0]}.json?&access_token=${MAPBOX_KEY}`)
//             .then(res => res.json())
//             .then(data => {
//                 console.log(data);
//                 try {
//                     map.flyTo({center: data.features[0].center, essential: true, zoom: 15})
//
//                 } catch (e) {
//                     console.log(e);
//                 }
//                 for (var i = 0; i < address.length; i++) {
// // create a HTML element for each feature
//
//                     const el = document.createElement('div');
//                     el.className = 'mapMarker';
//
// // make a marker for each feature and add it to the map
//
//
//                     new mapboxgl.Marker(el)
//                         .setLngLat(data.features[0].center).addTo(map)
//                         .setPopup(new mapboxgl.Popup({closeButton: false, offset: 45})
//                         .setHTML(`${orgName} <br> ${address}`)
//                         .addTo(map))
//                         .setLngLat(data.features[0].center).addTo(map);
//
//                 }
//             })
//     }

    // $(window).ready( function(){


    // $(document).on("mousemove", "#mapboxData", function () {
    //     console.log(this)
    //     let orgLocation = this.querySelector('#location').innerText
    //     let organizationName = this.getElementsByTagName("p")[0].innerText
    //     console.log("organizationName", organizationName);
    //     geocode(orgLocation, organizationName)
    //     // })
    // });

    /*]]>*/
</script>




</body>
</html>